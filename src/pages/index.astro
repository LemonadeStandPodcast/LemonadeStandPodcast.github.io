---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';
import { getCollection } from 'astro:content';
import FormattedDate from '../components/FormattedDate.astro';

const allEpisodes = await getCollection('episodes');
const sortedEpisodes = allEpisodes.sort((a, b) => b.data.episodeNumber - a.data.episodeNumber);
const latestEpisode = sortedEpisodes[0];
const recentEpisodes = sortedEpisodes.slice(1, 4);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body class="min-h-screen bg-white dark:bg-gray-800">
		<Header />
		
		<main class="min-h-screen">
			{latestEpisode && (
				<section class="border-b border-gray-200 dark:border-gray-700">
					<div class="container max-w-6xl mx-auto px-4 py-8">
						<div class="text-lime dark:text-lime-400 text-xl font-bold mb-4">LATEST EPISODE</div>
						<div class="w-full aspect-video mb-6">
							<iframe
								src={`https://www.youtube.com/embed/${latestEpisode.data.youtubeId}`}
								title={latestEpisode.data.title}
								class="w-full h-full"
								frameborder="0"
								allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
								allowfullscreen
							/>
						</div>
						<div>
							<div class="text-lime dark:text-lime-400 font-bold mb-2">#{latestEpisode.data.episodeNumber}</div>
							<h1 class="text-4xl font-bold text-gray-900 dark:text-gray-50 mb-4">
								<a href={`/episodes/${latestEpisode.slug}/`} class="hover:text-lime dark:hover:text-lime-400">
									{latestEpisode.data.title}
								</a>
							</h1>
							<p class="text-gray-600 dark:text-gray-400 mb-4">
								Recorded on: <FormattedDate date={latestEpisode.data.pubDate} />
							</p>
							<p class="text-lg text-gray-700 dark:text-gray-300 mb-6">{latestEpisode.data.description}</p>
							<div class="flex flex-wrap gap-2 mb-6">
								{latestEpisode.data.tags.map((tag) => (
									<a
										href={`/episodes?tag=${tag}`}
										class="bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 px-3 py-1 rounded-full text-sm hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
									>
										{tag}
									</a>
								))}
							</div>
							<a
								href={`/episodes/${latestEpisode.slug}/`}
								class="inline-block bg-gray-900 dark:bg-gray-100 text-white dark:text-gray-900 px-6 py-3 rounded-md font-medium hover:bg-lime hover:text-white dark:hover:bg-lime dark:hover:text-white transition-all duration-200"
							>
								Watch Episode
							</a>
						</div>
					</div>
				</section>
			)}

			{recentEpisodes.length > 0 && (
				<section class="container max-w-6xl mx-auto px-4 py-12">
					<h2 class="text-2xl font-bold text-gray-900 dark:text-gray-50 mb-8">Previous Episodes</h2>
					<div class="grid gap-8">
						{recentEpisodes.map((episode) => (
							<article class="flex flex-col md:flex-row bg-white dark:bg-gray-700/50 rounded-lg overflow-hidden shadow-sm hover:shadow-lg transition-all duration-300">
								<div class="md:w-64 shrink-0">
									<div class="aspect-video overflow-hidden">
										<img
											src={`https://img.youtube.com/vi/${episode.data.youtubeId}/hqdefault.jpg`}
											alt={episode.data.title}
											class="w-full h-full object-cover"
										/>
									</div>
								</div>
								<div class="flex-1 p-6">
									<div class="text-lime dark:text-lime-400 font-semibold text-sm mb-2">EPISODE #{episode.data.episodeNumber}</div>
									<h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
										<a href={`/episodes/${episode.slug}/`} class="hover:text-lime dark:hover:text-lime-400">
											{episode.data.title}
										</a>
									</h3>
									<p class="text-gray-500 dark:text-gray-300 text-sm mb-3">
										Recorded on: <FormattedDate date={episode.data.pubDate} />
									</p>
									<p class="text-gray-700 dark:text-gray-200 mb-4 line-clamp-2">
										{episode.data.description}
									</p>
									<div class="flex flex-wrap gap-2">
										{episode.data.tags.map((tag) => (
											<a 
												href={`/episodes?tag=${tag}`}
												class="bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-200 px-3 py-1 rounded-full text-sm hover:bg-gray-200 dark:hover:bg-gray-500 transition-colors"
											>
												{tag}
											</a>
										))}
									</div>
								</div>
							</article>
						))}
					</div>
				</section>
			)}
		</main>
		<Footer />
	</body>
</html>
