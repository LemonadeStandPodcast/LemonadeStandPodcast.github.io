---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../../consts';
import { getCollection } from 'astro:content';
import FormattedDate from '../../components/FormattedDate.astro';

const episodes = await getCollection('episodes');
const sortedEpisodes = episodes.sort((a, b) => b.data.episodeNumber - a.data.episodeNumber);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={`Episodes | ${SITE_TITLE}`} description={SITE_DESCRIPTION} />
	</head>
	<body class="bg-white dark:bg-gray-900">
		<Header />
		<main class="container max-w-3xl mx-auto px-6 py-8">
			<div class="mb-8">
				<h1 class="text-3xl font-bold text-gray-900 dark:text-gray-50 mb-6">
					All Episodes
				</h1>
			</div>

			<div class="grid gap-8" id="episodesContainer">
				{sortedEpisodes.map((episode) => (
					<article class="episode-card flex flex-col md:flex-row bg-white dark:bg-gray-700/50 rounded-lg overflow-hidden shadow-sm hover:shadow-lg transition-all duration-300">
						<div class="md:w-[56.25%] shrink-0 h-full">
							<a href={`/episodes/${episode.slug}/`} class="block h-full relative">
								<img
									src={`https://img.youtube.com/vi/${episode.data.youtubeId}/maxresdefault.jpg`}
									alt={episode.data.title}
									class="w-full h-full object-cover bg-black/10 dark:bg-black/30"
								/>
								<div class="absolute inset-0 bg-black/20 opacity-0 hover:opacity-100 transition-opacity duration-300"></div>
							</a>
						</div>
						<div class="flex-1 p-4 md:p-6 md:pl-8 flex flex-col">
							<div class="flex justify-between items-start mb-3">
								<h3 class="text-xl font-bold text-gray-900 dark:text-gray-50">
									<a href={`/episodes/${episode.slug}/`} class="text-gray-900 dark:text-gray-50 hover:text-lime-600 dark:hover:text-lime-300">
										#{episode.data.episodeNumber} {episode.data.title}
									</a>
								</h3>
								<p class="text-lime-600 dark:text-yellow-400 font-medium whitespace-nowrap text-sm ml-4">
									<FormattedDate date={episode.data.pubDate} />
								</p>
							</div>
							<p class="text-gray-700 dark:text-gray-200 mb-4">
								{episode.data.description}
							</p>
							<div class="mt-auto">
								<a href={`/episodes/${episode.slug}/`} 
									class="group relative inline-flex items-center justify-center px-6 py-2.5 font-medium transition-all duration-300 ease-in-out rounded-md overflow-hidden bg-lime-600 hover:bg-white text-white hover:text-lime-600 border-2 border-transparent hover:border-lime-600 dark:hover:bg-gray-900 dark:hover:text-lime-400 dark:hover:border-lime-400"
								>
									<span class="relative flex items-center gap-2">
										Details
										<svg 
											class="w-4 h-4 transition-transform duration-300 ease-out transform translate-x-0 group-hover:translate-x-1" 
											fill="none" 
											stroke="currentColor" 
											viewBox="0 0 24 24" 
											xmlns="http://www.w3.org/2000/svg"
										>
											<path 
												stroke-linecap="round" 
												stroke-linejoin="round" 
												stroke-width="2" 
												d="M13 7l5 5m0 0l-5 5m5-5H6"
											>
											</path>
										</svg>
									</span>
								</a>
							</div>
						</div>
					</article>
				))}
			</div>
		</main>
		<Footer />
	</body>
</html>