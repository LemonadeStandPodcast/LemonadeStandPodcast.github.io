---
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import ShareButtons from '../components/ShareButtons.astro';
import NewsletterSignup from '../components/NewsletterSignup.astro';

type Props = CollectionEntry<'episodes'>;

const { data, slug } = Astro.props;
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={data.title} description={data.description} />
	</head>

	<body>
		<Header />
		<main class="container max-w-4xl mx-auto px-4 py-8">
			<article class="bg-white rounded-lg shadow-sm overflow-hidden">
				<div class="w-full aspect-video mb-6">
					<iframe
						src={`https://www.youtube.com/embed/${data.youtubeId}`}
						title={data.title}
						class="w-full h-full"
						frameborder="0"
						allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
						allowfullscreen
					/>
				</div>
				<div class="px-6 pb-6">
					<div class="text-lime font-semibold mb-2">EPISODE #{data.episodeNumber}</div>
					<h1 class="text-4xl font-bold text-gray-900 mb-4">{data.title}</h1>
					<p class="text-gray-500 mb-6">
						Recorded on: <FormattedDate date={data.pubDate} />
					</p>
					
					<div class="flex flex-wrap gap-2 mb-8">
						{data.tags.map((tag) => (
							<a
								href={`/episodes?tag=${tag}`}
								class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm hover:bg-gray-200 transition-colors"
							>
								{tag}
							</a>
						))}
					</div>

					<div class="prose prose-lg max-w-none mb-8">
						<slot />
					</div>

					{data.citations && (
						<div class="border-t border-gray-200 pt-6 mb-8">
							<h2 class="text-xl font-bold text-gray-900 mb-4">Sources & References</h2>
							<ul class="space-y-2">
								{data.citations.map((citation) => (
									<li>
										<a
											href={citation.url}
											target="_blank"
											rel="noopener noreferrer"
											class="text-lime hover:underline"
										>
											{citation.title}
										</a>
									</li>
								))}
							</ul>
						</div>
					)}

					<ShareButtons title={data.title} url={`/episodes/${slug}`} />
				</div>
			</article>

			<NewsletterSignup />
		</main>
		<Footer />
	</body>
</html>